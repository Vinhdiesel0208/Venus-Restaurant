<!DOCTYPE html>
<html lang="en">
<!--begin::Head-->

<head th:replace="fragments/partial :: page_head('dishes', 'none')" />
<!--end::Head-->
<!--begin::Body-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<body data-kt-name="metronic" id="kt_app_body"
	data-kt-app-layout="dark-sidebar" data-kt-app-header-fixed="true"
	data-kt-app-sidebar-enabled="true" data-kt-app-sidebar-fixed="true"
	data-kt-app-sidebar-hoverable="true"
	data-kt-app-sidebar-push-header="true"
	data-kt-app-sidebar-push-toolbar="true"
	data-kt-app-sidebar-push-footer="true"
	data-kt-app-toolbar-enabled="true" class="app-default">
	<!--begin::Theme mode setup on page load-->
	<script>
		if (document.documentElement) {
			const defaultThemeMode = "system";
			const name = document.body.getAttribute("data-kt-name");
			let themeMode = localStorage.getItem("kt_"
					+ (name !== null ? name + "_" : "") + "theme_mode_value");
			if (themeMode === null) {
				if (defaultThemeMode === "system") {
					themeMode = window
							.matchMedia("(prefers-color-scheme: dark)").matches ? "dark"
							: "light";
				} else {
					themeMode = defaultThemeMode;
				}
			}
			document.documentElement.setAttribute("data-theme", themeMode);
		}
	</script>
	<!--end::Theme mode setup on page load-->
	<!--begin::App-->
	<div class="d-flex flex-column flex-root app-root" id="kt_app_root">
		<!--begin::Page-->
		<div class="app-page flex-column flex-column-fluid" id="kt_app_page">
			<div th:replace="fragments/header :: header">&nbsp;</div>
			<!--begin::Wrapper-->
			<div class="app-wrapper flex-column flex-row-fluid"
				id="kt_app_wrapper">
				<div th:replace="fragments/sidebar :: sidebar"></div>
				<!--begin::Main-->
				<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
					<!--begin::Content wrapper-->
					<div class="d-flex flex-column flex-column-fluid">
						<!--begin::Toolbar-->
						<div id="kt_app_toolbar" class="app-toolbar py-3 py-lg-6">
							<!--begin::Toolbar container-->
							<div id="kt_app_toolbar_container"
								class="app-container container-xxl d-flex flex-stack">
								<!--begin::Page title-->
								<div
									class="page-title d-flex flex-column justify-content-center flex-wrap me-3">
									<!--begin::Title-->
									<h1
										class="page-heading d-flex text-dark fw-bold fs-3 flex-column justify-content-center my-0">
										Dishes List</h1>
									<!--end::Title-->
									<!--begin::Breadcrumb-->
									<ul
										class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0 pt-1">
										<!--begin::Item-->
										<li class="breadcrumb-item text-muted"><a
											class="text-muted text-hover-primary">Home</a></li>
										<!--end::Item-->
										<!--begin::Item-->
										<li class="breadcrumb-item"><span
											class="bullet bg-gray-400 w-5px h-2px"></span></li>
										<!--end::Item-->
										<!--begin::Item-->
										<li class="breadcrumb-item text-muted">Dishes</li>
										<!--end::Item-->
									</ul>
									<!--end::Breadcrumb-->
								</div>
								<!--end::Page title-->
							</div>
							<!--end::Toolbar container-->
						</div>
						<!--end::Toolbar-->
						<!--begin::Content-->
						<div id="kt_app_content" class="app-content flex-column-fluid">
							<!--begin::Content container-->
							<div id="kt_app_content_container"
								class="app-container container-xxl">
								<!--begin::Card-->
								<div class="card">
									<!--begin::Card header-->
									<div class="card-header border-0 pt-6">
										<!--begin::Card title-->
										<div class="card-title">
											<!--begin::Search-->
											<div class="d-flex align-items-center position-relative my-1">
												<!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
												<span class="svg-icon svg-icon-1 position-absolute ms-6">
													<svg width="24" height="24" viewBox="0 0 24 24" fill="none"
														xmlns="http://www.w3.org/2000/svg">
														<rect opacity="0.5" x="17.0365" y="15.1223"
															width="8.15546" height="2" rx="1"
															transform="rotate(45 17.0365 15.1223)"
															fill="currentColor" />
														<path
															d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
															fill="currentColor" />
													</svg>
												</span>
												<!--end::Svg Icon-->
												<form th:action="@{'/dishes/search'}" method="post"
													class="form-inline">
													<input type="text" name="searchText"
														th:value="${searchText}"
														data-kt-customer-table-filter="search"
														class="form-control form-control-solid w-250px ps-15"
														placeholder="Search Dishes" />

												</form>

											</div>
											<!--end::Search-->
										</div>
										<!--begin::Card title-->
										<!--begin::Card toolbar-->
										<div class="card-toolbar">
											<!--begin::Toolbar-->
											

										</div>
										<!--end::Card toolbar-->
									</div>
									<!--end::Card header-->
									<!--begin::Card body-->
									<div class="card-body pt-0">
										<!--begin::Table-->
										<table class="table align-middle table-row-dashed fs-6 gy-5"
											id="kt_customers_table_skip">
											<!--begin::Table head-->
											<thead>
												<!--begin::Table row-->
												<tr
													class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
													<!-- <th class="w-10px pe-2">
														<div
															class="form-check form-check-sm form-check-custom form-check-solid me-3">
															<input class="form-check-input" type="checkbox"
																data-kt-check="true"
																data-kt-check-target="#kt_customers_table .form-check-input"
																value="1" />
														</div>
													</th> -->
													<th
														th:class="${sortField != 'ingredientName' ? 'min-w-125px' : (sortDir == 'asc' ? 'min-w-125px sorting_asc' :  'min-w-125px sorting_desc')}">
														<a
														th:href="@{${moduleURL} + '/page/' + ${currentPage} + '?sortField=ingredientName' +'&sortDir=' + ${sortField != 'ingredientName' ? sortDir : reverseSortDir} + ${searchText != null && searchText != '' ? '&searchText=' + searchText : ''}}">Dishes
															Name</a>
													</th>
													<th
														th:class="${sortField != 'ingredientCode' ? 'min-w-125px' : (sortDir == 'asc' ? 'min-w-125px sorting_asc' :  'min-w-125px sorting_desc')}">
														<a
														th:href="@{${moduleURL} + '/page/' + ${currentPage} + '?sortField=ingredientCode' +'&sortDir=' + ${sortField != 'ingredientCode' ? sortDir : reverseSortDir} + ${searchText != null && searchText != '' ? '&searchText=' + searchText : ''}}">Dishes
															Code</a>
													</th>

													<th
														th:class="${sortField != 'categoryName' ? 'min-w-125px' : (sortDir == 'asc' ? 'min-w-125px sorting_asc' :  'min-w-125px sorting_desc')}">
														<a
														th:href="@{${moduleURL} + '/page/' + ${currentPage} + '?sortField=categoryName' +'&sortDir=' + ${sortField != 'categoryName' ? sortDir : reverseSortDir} + ${searchText != null && searchText != '' ? '&searchText=' + searchText : ''}}">Category</a>
													</th>

													<th
														th:class="${sortField != 'price' ? 'min-w-125px' : (sortDir == 'asc' ? 'min-w-125px sorting_asc' :  'min-w-125px sorting_desc')}">
														<a
														th:href="@{${moduleURL} + '/page/' + ${currentPage} + '?sortField=price' +'&sortDir=' + ${sortField != 'price' ? sortDir : reverseSortDir} + ${searchText != null && searchText != '' ? '&searchText=' + searchText : ''}}">Price</a>
													</th>
													<th
														th:class="${sortField != 'name' ? 'min-w-125px' : (sortDir == 'asc' ? 'min-w-125px sorting_asc' :  'min-w-125px sorting_desc')}">
														<a
														th:href="@{${moduleURL} + '/page/' + ${currentPage} + '?sortField=name' +'&sortDir=' + ${sortField != 'name' ? sortDir : reverseSortDir} + ${searchText != null && searchText != '' ? '&searchText=' + searchText : ''}}"
														style="display: flex; align-items: center;">Photo</a>
													</th>

													<!-- Add more columns if needed -->

													<th
														th:class="${sortField != 'name' ? 'min-w-125px' : (sortDir == 'asc' ? 'min-w-125px sorting_asc' :  'min-w-125px sorting_desc')}">
														<a style="display: flex; align-items: center;">Action</a>
													</th>
												</tr>
												<!--end::Table row-->
											</thead>
											<!--end::Table head-->
											<!--begin::Table body-->
											<tbody class="fw-semibold text-gray-600">
												<tr th:each="ing : ${listIng}">
													<!--begin::Checkbox-->
													<!-- 	<td>
														<div
															class="form-check form-check-sm form-check-custom form-check-solid">
															<input class="form-check-input" type="checkbox" value="1" />
														</div>
													</td> -->
													<!--end::Checkbox-->
													<!--begin::Role Name=-->
													<td><a th:href="@{/dishes/{id}(id=${ing.id})}"
														class="text-gray-600 text-hover-primary mb-1"
														th:text="${ing.ingredientName}">-</a></td>
													<td th:text="${ing.ingredientCode}"></td>

													<td th:text="${ing.category.categoryName}"></td>

													<td th:text="${ing.price}"></td>
													<td th:if="${ing.photo}"><img
														th:src="@{${'/files/'+ing.photo}}" alt="Photo"
														class="img-thumbnail" src="" width="180" height="180">
													</td>

													<td><span>Status: </span> 
													<span
														th:text="${ing.status}"></span> <select
														th:attr="onchange=|updateStatus(this, ${ing.id})|"
														class="form-select form-select-sm">
															<option value="">---Change Status ---</option>
															<option value="Available"
																th:selected="${ing.status == 'Available'}">Available</option>
															<option value="NotAvailable"
																th:selected="${ing.status == 'NotAvailable'}">Not Available</option>
															
													</select> <span><a
															th:href="@{/dishes/edit/{id}(id=${ing.id})}">Edit</a> </span></td>

													<!--end::Action=-->
												</tr>
											</tbody>
											<!--end::Table body-->
										</table>
										<!--end::Table-->
										<!--begin::Paginate-->
										<div th:if="${totalPages > 1}">
											<ul class="pagination">
												<li
													th:class="${currentPage > 1 ? 'page-item previous' : 'page-item previous disabled'}">
													<a
													th:href="@{${moduleURL} + '/page/' + (${currentPage - 1}) + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&searchText=' + ${searchText}}"
													class="page-link"> <i class="previous"></i>
												</a>
												</li>
												<li th:each="i : ${#numbers.sequence(1, totalPages)}"
													th:class="${currentPage != i ? 'page-item' : 'page-item active'}">
													<a
													th:href="@{${moduleURL} + '/page/' + ${i} + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&searchText=' + ${searchText}}"
													class="page-link" th:text="${i}"></a>
												</li>
												<li
													th:class="${currentPage < totalPages ? 'page-item next' : 'page-item next disabled'}">
													<a
													th:href="@{${moduleURL} + '/page/' + (${currentPage + 1}) + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} + '&searchText=' + ${searchText}}"
													class="page-link"> <i class="next"></i>
												</a>
												</li>
											</ul>
										</div>
									</div>

								</div>
								<!--end::Content container-->
							</div>
							<!--end::Content-->
						</div>
						<!--end::Content wrapper-->
						<!--begin::Footer-->
						<div th:replace="fragments/footer :: footer">&nbsp;</div>
						<!--end::Footer-->
					</div>
					<!--end:::Main-->
				</div>
				<!--end::Wrapper-->
			</div>
			<!--end::Page-->
		</div>
		</div>
		<!--end::App-->
		<!--begin::Scrolltop-->
		<div id="kt_scrolltop" class="scrolltop" data-kt-scrolltop="true">
			<!--begin::Svg Icon | path: icons/duotune/arrows/arr066.svg-->
			<span class="svg-icon"> <svg width="24" height="24"
					viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
				<rect opacity="0.5" x="13" y="6" width="13" height="2" rx="1"
						transform="rotate(90 13 6)" fill="currentColor" />
				<path
						d="M12.5657 8.56569L16.75 12.75C17.1642 13.1642 17.8358 13.1642 18.25 12.75C18.6642 12.3358 18.6642 11.6642 18.25 11.25L12.7071 5.70711C12.3166 5.31658 11.6834 5.31658 11.2929 5.70711L5.75 11.25C5.33579 11.6642 5.33579 12.3358 5.75 12.75C6.16421 13.1642 6.83579 13.1642 7.25 12.75L11.4343 8.56569C11.7467 8.25327 12.2533 8.25327 12.5657 8.56569Z"
						fill="currentColor" />
			</svg>
			</span>
			<!--end::Svg Icon-->
		</div>
		<!--end::Scrolltop-->
		<!--begin::Javascript-->
		<div th:replace="fragments/partial :: global_script"></div>
		<div th:replace="fragments/partial :: users_script"></div>
		<!--end::Javascript-->
</body>
<!--end::Body-->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
function updateStatus(selectElement, id) {
    const status = selectElement.value;

    fetch(`/dishes/updateStatus?id=${id}&status=${status}`, {
        method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'conflict') {
                Swal.fire({
                title: 'Số lượng còn lại không bằng không',
                text: "Bạn có muốn tiếp tục?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Tiếp tục'
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/dishes/updateStatus?id=${id}&status=${status}&force=true`, {
                        method: 'POST',
                    })
                    .then(response => response.json())
                    .then(data => {
                        Swal.fire('Thành công', data.message, 'success');
                        setTimeout(function() {
                            location.reload(); 
                        }, 1500);
                    })
                    .catch(error => {
                        Swal.fire('Lỗi', 'Có lỗi xảy ra khi cập nhật trạng thái.', 'error');
                    });
                }
            });
        } else {
      
            Swal.fire('Thành công', data.message, 'success');
            setTimeout(function() {
                location.reload();
            }, 1500); 
        }
    })
    .catch(error => {
    	 console.error('Fetch error:', error);
        Swal.fire('Lỗi', 'Có lỗi xảy ra khi cập nhật trạng thái.', 'error');
    });
}
</script>

</html>